server:
  port: 9997

spring:
  application:
    name: gateway-server

  main:
    allow-bean-definition-overriding: true

  cloud:
    nacos:
      discovery:
        server-addr: 192.168.190.129:8848
      config:
        server-addr: 192.168.190.129:8848
        file-extension: yml

  redis:
    database: 0
    host: 192.168.190.129
    port: 6379
    password: 123456
    timeout: 6000ms
    lettuce:
      pool:
        max-active: 8
        max-wait: -1ms
        max-idle: 8
        min-idle: 0


    sentinel:
      #取消Sentinel控制台懒加载
      eager: true
      filter:
        enabled: false
      transport:
        dashboard: 192.168.190.129:8080
        port: 8890

    gateway:
      globalcors:
        ## 全局允许跨域访问
        cors-configurations:
          '[/**]':
            allow-credentials: true
            allowed-origins: "*"
            allowed-headers: "*"
            allowed-methods:
              - OPTIONS
              - GET
              - POST
              - PUT
              - DELETE

      #全局默认熔断配置
      default-filters:
        - Session
        - name: Hystrix
          args:
            name: fetchIngredients
            fallbackUri: forward:/fallback
        - name: Retry
          args:
            retries: 3
            statuses: BAD_GATEWAY,BAD_REQUEST
            methods: GET,POST


      discovery:
        locator:
          ## 开启项目名称映射功能，即通过服务名访问项目，不需要写明具体IP地址
          enabled: true
          ## 请求路由全部转小写字母，如 Aa/Bb 会被转为 aa/bb
          lower-case-service-id: true

      routes:
        - id: product-server
          ## 转发到的节点，lb:// 为 http，lb:ws:// 为 websocket
          uri: lb://product-server
          predicates:
            ## 断言规则，这里设置匹配的路由规则
            - Path=/test/product-server/**
          filters:
            #去掉url的第一个前缀，用后面的内容拼接到uri
            - StripPrefix=1

#默认熔断超时时间30s
hystrix:
  command:
    fetchIngredients:
      execution:
        isolation:
          strategy: SEMAPHORE
          thread:
            timeoutInMilliseconds: 3000
  shareSecurityContext: true




